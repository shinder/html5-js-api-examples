<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>070 路線規劃</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 500px;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <h2>070 路線規劃</h2>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const startPoint = [25.033, 121.5654]; // 台北 101
      const endPoint = [25.0478, 121.517]; // 台北車站
      // 初始化地圖
      const map = L.map("map").setView(startPoint, 13);

      // 添加 OSM 圖層
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution:
          '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      }).addTo(map);

      // 使用 OSRM API 進行路線規劃
      async function getRoute(start, end) {
        const url = `https://router.project-osrm.org/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`;

        try {
          const response = await fetch(url);
          const data = await response.json();
          console.log(data);

          if (data.routes && data.routes.length > 0) {
            return data.routes[0];
          }
        } catch (error) {
          console.error("路線規劃錯誤:", error);
        }
        return null;
      }

      // 使用範例

      getRoute(startPoint, endPoint).then((route) => {
        if (route) {
          // 顯示路線
          L.geoJSON(route.geometry, {
            style: {
              color: "#0080ff",
              weight: 5,
              opacity: 0.8,
            },
          }).addTo(map);

          // 顯示距離和時間
          const distance = (route.distance / 1000).toFixed(1);
          const duration = Math.round(route.duration / 60);
          console.log(`距離: ${distance} km, 時間: ${duration} 分鐘`);
        }
      });
    </script>
  </body>
</html>
